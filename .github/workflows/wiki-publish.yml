name: ðŸ“š Publish to Wiki on New Release

on:
  release:
    types: [published]

jobs:
  publish-migration-guide:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main repository
        uses: actions/checkout@v6

      # Find migration guid
      - name: Set migration guide path
        id: find_guide
        run: |
          guide_name="migration-${{ github.event.release.tag_name }}.md"
          echo "guide_path=docs/${guide_name}" >> $GITHUB_ENV
          echo "guide_name=${guide_name}" >> $GITHUB_ENV

      - name: Check if migration guide exists
        id: check_files
        uses: andstor/file-existence-action@v3
        with:
          files: "${{ env.guide_path }}"

      - name: Checkout Wiki repository
        if: steps.check_files.outputs.files_exists == 'true'
        uses: actions/checkout@v6
        with:
          repository: ${{ github.repository }}.wiki
          path: wiki

      - name: Copy guide to Wiki and Push
        if: steps.check_files.outputs.files_exists == 'true'
        run: |
          cd wiki
          cp ../${{ env.guide_path }} .

          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

          # ÎšÎ¬Î½Îµ commit ÎºÎ±Î¹ push
          git add .
          git commit -m "docs: Add migration guide for ${{ github.event.release.tag_name }}"
          git push